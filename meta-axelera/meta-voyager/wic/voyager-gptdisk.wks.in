# Copyright (c) 2019, Fuzhou Rockchip Electronics Co., Ltd
# Released under the MIT license (see COPYING.MIT for the terms)
#
# long-description: Creates a GPT disk image for Rockchip boards

# 0~32K: gpt
bootloader --ptable gpt
part --source rawcopy --sourceparams="file=idblock.img" --align 32 --no-table
part --source rawcopy --sourceparams="file=uboot.img" --part-name uboot --align 8192 --fixed-size 12M
part --source rawcopy --sourceparams="file=boot.img" --part-name boot_a --fixed-size 32M
part --source rawcopy --sourceparams="file=boot.img" --part-name boot_b --fixed-size 32M
part --source rawcopy --sourceparams="file=u-boot-env.img" --part-name env_a --fixed-size 128K
part --source rawcopy --sourceparams="file=u-boot-env.img" --part-name env_b --fixed-size 128K
# Note fixed-size should == MENDER_STORAGE_TOTAL_SIZE_MB / 2
part / --source rootfs --fstype ext4 --part-name system_a --uuid ${RK_ROOTDEV_UUID} --align 8192 --fixed-size 2048M
part / --source rootfs --fstype ext4 --part-name system_b --uuid ${RK_ROOTDEV_UUID} --align 8192 --fixed-size 2048M
# Note fixed-size should >= voyager-factory.img file
part --source rawcopy --sourceparams="file=${IMGDEPLOYDIR}/voyager-factory.img" --part-name "voyager-factory" --fstype ext4 --align 8192 --fixed-size 128M
part --source rawcopy --sourceparams="file=${IMGDEPLOYDIR}/voyager-data.img" --part-name "voyager-data" --fstype ext4 --align 8192
