From ee715f8d2879d881d532dcf5a9633ed08c49ae57 Mon Sep 17 00:00:00 2001
From: Michael Trimarchi <michael@amarulasolutions.com>
Date: Wed, 4 Dec 2024 16:34:24 +0000
Subject: [PATCH] Fix cross-compille fixups

Add the following to Makefile to allow cross-compiling in Yocto:
 - ARCH variable
 - all:
 - clean:

Clean is optional, but makes managing development a bit easier.

Signed-off-by: Adam Duskett <adam.duskett@amarulasolutions.com>
Signed-off-by: Michael Trimarchi <michael@amarulasolutions.com>
---
 Makefile | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/os/driver/Makefile b/os/driver/Makefile
index b3d63f4..ed320ec 100755
--- a/os/driver/Makefile
+++ b/os/driver/Makefile
@@ -1,5 +1,5 @@
-
 # Copyright (c) 2023 Axelera AI. All rights reserved.
+ARCH ?= arm64
 
 obj-m += dmabuf-triton-exporter.o
 obj-m += dmabuf-triton-importer.o
@@ -7,3 +7,9 @@ obj-m += axl-pcie-reset.o
 obj-m += metis.o
 
 metis-y += metis-core.o
+
+all:
+	make ARCH=$(ARCH) -C $(KERNEL_PATH) M=$(PWD) modules
+
+clean:
+	make ARCH=$(ARCH) -C $(KERNEL_PATH) M=$(PWD) clean
-- 
2.39.2

